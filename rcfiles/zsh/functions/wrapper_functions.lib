#!/usr/bin/env zsh
# vim: ft=sh
# Arquivo: wrapper for ping and host
# Criado: ter 27/dez/2016 hs 07:12
# Last Change: sex 30 dez 2016 08:48:34 BRT
# autor: Sérgio Luiz Araújo Silva 
# site: http://vivaotux.blogspot.com
# twitter: @voyeg3r
# email: <voyeg3r  gmail.com> 
# source: https://www.cyberciti.biz/tips/unix-linux-bash-shell-script-wrapper-examples.html

# PING WRAPPER ------------------------------------------------

# source: http://www.cyberciti.biz/tips/unix-linux-bash-shell-script-wrapper-examples.html
_getdomainnameonly(){
# Name: _getdomainnameonly
# Arg: Url/domain/ip
# Returns: Only domain name
# Purpose: Get domain name and remove protocol part, username:password and other parts from url
# get url
local h="$1"
# upper to lowercase
        local f="${h:l}"
# remove protocol part of hostname
        f="${f#http://}"
        f="${f#https://}"
        f="${f#ftp://}"
        f="${f#scp://}"
        f="${f#scp://}"
        f="${f#sftp://}"
# Remove username and/or username:password part of hostname
        f="${f#*:*@}"
        f="${f#*@}"
# remove all /foo/xyz.html*
        f=${f%%/*}
# show domain name only
echo "$f"
}

# Name: ping() wrapper
# Arg: url/domain/ip
# Purpose: Send ping request to domain by removing urls, protocol, username:pass using system /usr/bin/ping
ping(){
    local array=( $@ )  		# get all args in an array
    local host=${array[-1]}     # get the last arg
    local args=${array[1,-2]}   # get all args before last arg in $@
    local _ping="/usr/bin/ping"
    local c=$(_getdomainnameonly "$host")
    [ "$host" != "$c" ] && echo "Sending ICMP ECHO_REQUEST to \"$c\"..."
    # pass args and host
    # $_ping $args $c
    # default args for ping
    $_ping -n -c 2 -i 1 -W1 $c
}

host(){
# Name: host() wrapper
# Arg: Domain/Url/IP
# Purpose: Dns lookups system /usr/bin/host
local t="$1"
local _host="/usr/bin/host"
local c=$(_getdomainnameonly "$t")
[ "$t" != "$c" ] && echo "Performing DNS lookups for \"$c\"..."
$_host $c
}
# END PING WRAPPER ------------------------------------------------


subslider(){
# subslider wrapper
# how to deal with arrays in zsh: http://zshwiki.org/home/scripting/array
# purpuse: remove DOS characters generated by subslider script
    local _subslider="${HOME}/bin/subslider"
    $_subslider $@
    # creates a local array buffer
    local -a param
    param=(${@[-2]})
    #sed -i 's/\x0D$//' "${param:r}_orig.srt"
    # [[ ! -z "$param"  ]] && sed -i 's/\x0D$//' "${param:r}.srt"
    [[ -f "${param:r}_offset.srt"  ]] && sed -i 's/\x0D$//' "${param:r}_offset.srt"
    mv "${param}" ~/.local/share/Trash/files/"${param:r}-$(date +%H-%M-%S).srt" && mv "${param:r}_offset.srt" "${param}"
}

